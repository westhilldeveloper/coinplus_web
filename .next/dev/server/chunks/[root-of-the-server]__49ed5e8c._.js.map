{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/coinplusweb/app/lib/prisma.js"],"sourcesContent":["// app/lib/prisma.js\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis\r\n\r\nconst prisma = globalForPrisma.prisma || new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\nexport default prisma"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;;AAEA,MAAM,kBAAkB;AAExB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEzD,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/coinplusweb/app/api/chits/branches/route.js"],"sourcesContent":["// app/api/chits/branches/route.js\r\nimport prisma from '../../../lib/prisma'\r\nimport { NextResponse } from 'next/server'\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const state = searchParams.get('state')\r\n    \r\n    // Build where clause\r\n    const where = {\r\n      branch: {\r\n        not: null,\r\n        not: '', // Also filter out empty strings\r\n      }\r\n    }\r\n    \r\n    if (state) {\r\n      where.state = state\r\n    }\r\n\r\n    // Get branches with additional info\r\n    const branchesData = await prisma.chit.findMany({\r\n      select: {\r\n        state: true,\r\n        branch: true,\r\n        location: true,\r\n      },\r\n      where,\r\n      distinct: ['state', 'branch'], // Get unique state-branch combinations\r\n      orderBy: [\r\n        { state: 'asc' },\r\n        { branch: 'asc' }\r\n      ]\r\n    })\r\n\r\n    // Get counts for each branch\r\n    const branchesWithCount = await Promise.all(\r\n      branchesData.map(async (item) => {\r\n        const count = await prisma.chit.count({\r\n          where: {\r\n            state: item.state,\r\n            branch: item.branch\r\n          }\r\n        })\r\n        \r\n        return {\r\n          state: item.state,\r\n          branch: item.branch,\r\n          location: item.location,\r\n          count: count\r\n        }\r\n      })\r\n    )\r\n\r\n    // Group by state if no specific state filter\r\n    let result\r\n    if (state) {\r\n      // If state filter is applied, just return branches\r\n      result = {\r\n        state,\r\n        branches: branchesWithCount\r\n      }\r\n    } else {\r\n      // Group by state\r\n      const groupedByState = branchesWithCount.reduce((acc, branch) => {\r\n        if (!acc[branch.state]) {\r\n          acc[branch.state] = []\r\n        }\r\n        acc[branch.state].push(branch)\r\n        return acc\r\n      }, {})\r\n      \r\n      result = {\r\n        grouped: groupedByState,\r\n        allBranches: branchesWithCount\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      ...result,\r\n      total: branchesWithCount.length\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching branches:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: error.message },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAClC;AACA;;;AAEO,eAAe,IAAI,OAAO;IAC/B,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,QAAQ,aAAa,GAAG,CAAC;QAE/B,qBAAqB;QACrB,MAAM,QAAQ;YACZ,QAAQ;gBACN,KAAK;gBACL,KAAK;YACP;QACF;QAEA,IAAI,OAAO;YACT,MAAM,KAAK,GAAG;QAChB;QAEA,oCAAoC;QACpC,MAAM,eAAe,MAAM,iIAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YAC9C,QAAQ;gBACN,OAAO;gBACP,QAAQ;gBACR,UAAU;YACZ;YACA;YACA,UAAU;gBAAC;gBAAS;aAAS;YAC7B,SAAS;gBACP;oBAAE,OAAO;gBAAM;gBACf;oBAAE,QAAQ;gBAAM;aACjB;QACH;QAEA,6BAA6B;QAC7B,MAAM,oBAAoB,MAAM,QAAQ,GAAG,CACzC,aAAa,GAAG,CAAC,OAAO;YACtB,MAAM,QAAQ,MAAM,iIAAM,CAAC,IAAI,CAAC,KAAK,CAAC;gBACpC,OAAO;oBACL,OAAO,KAAK,KAAK;oBACjB,QAAQ,KAAK,MAAM;gBACrB;YACF;YAEA,OAAO;gBACL,OAAO,KAAK,KAAK;gBACjB,QAAQ,KAAK,MAAM;gBACnB,UAAU,KAAK,QAAQ;gBACvB,OAAO;YACT;QACF;QAGF,6CAA6C;QAC7C,IAAI;QACJ,IAAI,OAAO;YACT,mDAAmD;YACnD,SAAS;gBACP;gBACA,UAAU;YACZ;QACF,OAAO;YACL,iBAAiB;YACjB,MAAM,iBAAiB,kBAAkB,MAAM,CAAC,CAAC,KAAK;gBACpD,IAAI,CAAC,GAAG,CAAC,OAAO,KAAK,CAAC,EAAE;oBACtB,GAAG,CAAC,OAAO,KAAK,CAAC,GAAG,EAAE;gBACxB;gBACA,GAAG,CAAC,OAAO,KAAK,CAAC,CAAC,IAAI,CAAC;gBACvB,OAAO;YACT,GAAG,CAAC;YAEJ,SAAS;gBACP,SAAS;gBACT,aAAa;YACf;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,GAAG,MAAM;YACT,OAAO,kBAAkB,MAAM;QACjC;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}